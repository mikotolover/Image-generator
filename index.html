<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ì¤‘ ì´ë¯¸ì§€ ë©”ì´ì»¤ (ë¯¸ë¦¬ë³´ê¸° í¬í•¨)</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; line-height: 1.6; background-color: #f4f4f9; }
        .container { max-width: 600px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { margin-bottom: 25px; color: #333; }
        .input-group { margin-bottom: 20px; text-align: left; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
        input[type=file] { display: block; width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background: #fafafa; }
        
        /* ë¯¸ë¦¬ë³´ê¸° ê´€ë ¨ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .preview-container { display: flex; justify-content: space-between; margin-bottom: 20px; gap: 10px; }
        .preview-box { flex: 1; border: 1px solid #eee; padding: 10px; border-radius: 8px; background: #fafafa; }
        .preview-box p { margin: 5px 0; font-size: 14px; color: #666; word-break: break-all; }
        .preview-canvas { width: 100%; height: auto; border: 1px solid #ccc; background: #eee; /* íˆ¬ëª… ì˜ì—­ í™•ì¸ìš© ë°°ê²½ */ }

        button { background: #007BFF; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; width: 100%; font-size: 18px; font-weight: bold; transition: background 0.3s; }
        button:hover { background: #0056b3; }
        #resultCanvas { max-width: 100%; margin-top: 30px; border: 1px solid #eee; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        #downloadBtn { display: none; background: #28a745; margin-top: 15px; text-decoration: none; color: white; padding: 12px; border-radius: 8px; font-weight: bold; transition: background 0.3s; }
        #downloadBtn:hover { background: #218838; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸŒ“ ì´ì¤‘ ì´ë¯¸ì§€ ë©”ì´ì»¤</h2>
    <p>ë‹¤í¬ëª¨ë“œ/ë¼ì´íŠ¸ëª¨ë“œì—ì„œ ë³´ì¼ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ë©´ ì „ì²˜ë¦¬ëœ ê²°ê³¼ë¥¼ ë¯¸ë¦¬ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    
    <div class="input-group">
        <label for="darkInput">ğŸŒ‘ ë‹¤í¬ ëª¨ë“œìš© ì´ë¯¸ì§€:</label>
        <input type="file" id="darkInput" accept="image/*">
    </div>
    
    <div class="input-group">
        <label for="lightInput">â˜€ï¸ ë¼ì´íŠ¸ ëª¨ë“œìš© ì´ë¯¸ì§€:</label>
        <input type="file" id="lightInput" accept="image/*">
    </div>

    <div class="preview-container">
        <div class="preview-box">
            <label>ğŸŒ‘ ë‹¤í¬ ì „ì²˜ë¦¬ ë¯¸ë¦¬ë³´ê¸°</label>
            <p id="darkFileName">íŒŒì¼ ì—†ìŒ</p>
            <canvas id="darkPreviewCanvas" class="preview-canvas"></canvas>
        </div>
        <div class="preview-box">
            <label>â˜€ï¸ ë¼ì´íŠ¸ ì „ì²˜ë¦¬ ë¯¸ë¦¬ë³´ê¸°</label>
            <p id="lightFileName">íŒŒì¼ ì—†ìŒ</p>
            <canvas id="lightPreviewCanvas" class="preview-canvas"></canvas>
        </div>
    </div>
    
    <button onclick="processImages()">ìµœì¢… ì´ë¯¸ì§€ ìƒì„±í•˜ê¸°</button>
    
    <canvas id="resultCanvas"></canvas>
    <a id="downloadBtn">ê²°ê³¼ ì €ì¥í•˜ê¸°</a>
</div>

<script>
// ì´ë¯¸ì§€ ë¡œë“œ í—¬í¼ í•¨ìˆ˜ (ì „ì—­ìœ¼ë¡œ ì´ë™)
const loadImage = (file) => new Promise((resolve) => {
    const img = new Image();
    const url = URL.createObjectURL(file);
    img.onload = () => {
        URL.revokeObjectURL(url);
        resolve(img);
    };
    img.src = url;
});

// íŒŒì¼ ì…ë ¥ ì‹œ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
document.getElementById('darkInput').addEventListener('change', () => updatePreview('dark'));
document.getElementById('lightInput').addEventListener('change', () => updatePreview('light'));

// ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (í•µì‹¬ ì „ì²˜ë¦¬ ë¡œì§ ì ìš©)
async function updatePreview(type) {
    const inputId = type === 'dark' ? 'darkInput' : 'lightInput';
    const canvasId = type === 'dark' ? 'darkPreviewCanvas' : 'lightPreviewCanvas';
    const fileNameId = type === 'dark' ? 'darkFileName' : 'lightFileName';
    
    const fileInput = document.getElementById(inputId);
    const file = fileInput.files[0];
    
    if (!file) return;

    // íŒŒì¼ëª… í‘œì‹œ ì—…ë°ì´íŠ¸ (ëª¨ë°”ì¼ì—ì„œë„ ì‹¤ì œ íŒŒì¼ëª… í‘œì‹œë¨)
    document.getElementById(fileNameId).textContent = file.name;

    const img = await loadImage(file);
    const canvas = document.getElementById(canvasId);
    const ctx = canvas.getContext('2d', { willReadFrequently: true });

    // ë¯¸ë¦¬ë³´ê¸° ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì • (ì›ë³¸ ë¹„ìœ¨ ìœ ì§€í•˜ë©° ë„ˆë¹„ ê³ ì •)
    const previewWidth = 250;
    const scaleFactor = previewWidth / img.width;
    canvas.width = previewWidth;
    canvas.height = img.height * scaleFactor;

    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const data = imageData.data;

    // í”½ì…€ë³„ ì „ì²˜ë¦¬ ë¡œì§ ì ìš© ë£¨í”„
    for (let i = 0; i < data.length; i += 4) {
        // 1. ê¸°ë³¸ í‘ë°±(Grayscale) ë°ê¸° ê³„ì‚° (0.0 ~ 1.0)
        const gray = (data[i] + data[i+1] + data[i+2]) / 765;
        
        let preprocessedGray;
        if (type === 'dark') {
            // ë‹¤í¬ëª¨ë“œìš© ê³µì‹: ë°ê¸°ë¥¼ ì ˆë°˜ìœ¼ë¡œ ì¤„ì„ (0.0 ~ 0.5 ë²”ìœ„ê°€ ë¨)
            // ìµœì¢… ì½”ë“œì˜ c_black = gD * 0.5 ë¶€ë¶„ì— í•´ë‹¹
            preprocessedGray = gray * 0.5;
        } else {
            // ë¼ì´íŠ¸ëª¨ë“œìš© ê³µì‹: ë°ê¸°ë¥¼ ì ˆë°˜ìœ¼ë¡œ ì¤„ì´ê³  0.5ë¥¼ ë”í•¨ (0.5 ~ 1.0 ë²”ìœ„ê°€ ë¨)
            // ìµœì¢… ì½”ë“œì˜ c_white = gL * 0.5 + 0.5 ë¶€ë¶„ì— í•´ë‹¹
            preprocessedGray = gray * 0.5 + 0.5;
        }

        // ê³„ì‚°ëœ ë°ê¸°ë¥¼ ë‹¤ì‹œ 0~255 ë²”ìœ„ì˜ ì»¬ëŸ¬ê°’ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì ìš©
        const finalColor = preprocessedGray * 255;
        data[i] = finalColor;     // R
        data[i+1] = finalColor;   // G
        data[i+2] = finalColor;   // B
        // data[i+3] (Alpha)ëŠ” ê±´ë“œë¦¬ì§€ ì•Šì•„ ë¶ˆíˆ¬ëª…í•˜ê²Œ ìœ ì§€
    }
    // ì „ì²˜ë¦¬ëœ ë°ì´í„°ë¥¼ ìº”ë²„ìŠ¤ì— ë‹¤ì‹œ ê·¸ë¦¬ê¸°
    ctx.putImageData(imageData, 0, 0);
}


// ìµœì¢… ì´ë¯¸ì§€ ìƒì„± í•¨ìˆ˜ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
async function processImages() {
    const darkFile = document.getElementById('darkInput').files[0];
    const lightFile = document.getElementById('lightInput').files[0];

    if (!darkFile || !lightFile) {
        alert("ì´ë¯¸ì§€ ë‘ ê°œë¥¼ ëª¨ë‘ ê³¨ë¼ì£¼ì„¸ìš”");
        return;
    }
    
    // loadImage í•¨ìˆ˜ëŠ” ìœ„ì—ì„œ ì •ì˜í•œ ê²ƒì„ ì¬ì‚¬ìš©
    const [imgD, imgL] = await Promise.all([loadImage(darkFile), loadImage(lightFile)]);

    const canvas = document.getElementById('resultCanvas');
    // ìº”ë²„ìŠ¤ ì´ˆê¸°í™” (ì´ì „ ê²°ê³¼ ì§€ìš°ê¸°)
    const ctx = canvas.getContext('2d', { willReadFrequently: true });
    ctx.clearRect(
